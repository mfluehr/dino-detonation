!function(e){var t={};function s(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s(1)().load()},function(e,t,s){"use strict";const o=s(2),r=s(10);e.exports=(()=>{const e=()=>{t.els={views:document.getElementsByClassName("view"),lobby:document.getElementById("lobby-view"),room:document.getElementById("room-view"),game:document.getElementById("game-view")},t.socket=io.connect(t.url),t.lobby=o(t),t.user=r(t,t.lobby)},t=(()=>{const t=Object.seal({lobby:void 0,els:void 0,socket:void 0,url:"localhost:4000",user:void 0,view:void 0,get load(){return e}});return new Proxy(t,{get:(e,t)=>e[t],set:(e,t,s)=>(e[t]=s,!0)})})();return t})},function(e,t,s){"use strict";const o=s(3),r=s(4),n=s(5);e.exports=(e=>{const t=e=>{h.els={createRoom:document.getElementById("create-room"),login:document.getElementById("login"),roomList:document.getElementById("lobby-view-rooms"),roomName:document.getElementById("room-name"),userList:document.getElementById("lobby-view-users"),userName:document.getElementById("user-name")},e.rooms.forEach(e=>i(e)),e.users.forEach(e=>c(e)),h.els.createRoom.addEventListener("click",f.createRoom),h.els.login.addEventListener("click",f.login),h.els.roomList.addEventListener("click",f.joinRoom)},s=t=>{e.user.room=n(e,h,t)},a=t=>{h.els.userList.querySelector(`[data-id="${t}"]`).classList.add("personal"),e.user.load(t),e.view="lobby"},i=e=>{const t=o(e.props,h);h.rooms.set(t.id,t)},c=e=>{const t=r(e.props,h);h.users.set(t.id,t)},l=(e,t)=>{new Set(["name","maxUsers","numUsers"]).has(t)&&(h.els.roomList.querySelector(`[data-id="${e.id}"] .${t}`).innerText=e[t])},d=(e,t)=>{new Set(["name"]).has(t)&&(h.els.userList.querySelector(`[data-id="${e.id}"] .${t}`).innerText=e[t])},u=e=>{Object.assign(h.rooms.get(e.id),e.props)},m=e=>{Object.assign(h.users.get(e.id),e.props)},p=()=>{h.els.createRoom.removeEventListener("click",f.createRoom),h.els.login.removeEventListener("click",f.login),h.els.roomList.removeEventListener("click",f.joinRoom),y(),L(),console.log("Lobby connection lost!")},v=e=>{h.rooms.delete(e)},y=()=>{h.rooms.clear(),e.user.room&&e.user.room.unload()},g=e=>{h.users.delete(e)},L=()=>{h.users.clear()},f={createRoom:()=>{const t=h.els.roomName.value;e.socket.emit("loadRoom",t)},joinRoom:t=>{"A"===t.target.tagName&&e.user.joinRoom(t.target.dataset.id)},login:()=>{e.user.name=h.els.userName.value}},h=(()=>{const e=Object.seal({els:void 0,rooms:new Map,users:new Map,get showRoomUpdate(){return l},get showUserUpdate(){return d}});return e.rooms.set=function(e,t){return(({id:e,name:t,numUsers:s,maxUsers:o})=>{h.els.roomList.insertAdjacentHTML("beforeend",`<tr data-id="${e}">`+`<td><a class="name" href="#" data-id="${e}">${t}</a></td>`+"<td>"+`<span class="numUsers">${s}</span> / `+`<span class="maxUsers">${o}</span>`+"</td></tr>")})(t),Map.prototype.set.apply(this,arguments)},e.rooms.clear=function(){for(;e.els.roomList.firstChild;)e.els.roomList.removeChild(e.els.roomList.firstChild);return Map.prototype.clear.apply(this,arguments)},e.rooms.delete=function(e){return(e=>{h.els.roomList.querySelector(`[data-id="${e}"]`).remove()})(e),Map.prototype.delete.apply(this,arguments)},e.users.set=function(e,t){return(({id:e,name:t})=>{h.els.userList.insertAdjacentHTML("beforeend",`<li data-id="${e}">`+`<span class="name">${t}</span>`+"</li>")})(t),Map.prototype.set.apply(this,arguments)},e.users.clear=function(){for(;e.els.userList.firstChild;)e.els.userList.removeChild(e.els.userList.firstChild);return Map.prototype.clear.apply(this,arguments)},e.users.delete=function(e){return(e=>{h.els.userList.querySelector(`[data-id="${e}"]`).remove()})(e),Map.prototype.delete.apply(this,arguments)},e})();return e.socket.on("disconnect",p),e.socket.on("ioError",e=>console.warn(e)),e.socket.on("loadLobby",t),e.socket.on("loadLobbyRoom",i),e.socket.on("loadLobbyUser",c),e.socket.on("loadLocalRoom",s),e.socket.on("loadPersonalUser",a),e.socket.on("syncLobbyRoom",u),e.socket.on("syncLobbyUser",m),e.socket.on("unloadLobbyRoom",v),e.socket.on("unloadLobbyUser",g),h})},function(e,t,s){"use strict";e.exports=((e,t)=>{const s=new Proxy(e,{set:(e,o,r)=>(e[o]=r,t.showRoomUpdate(s,o),!0)});return s})},function(e,t,s){"use strict";e.exports=((e={},t)=>{const s=new Proxy(e,{set:(e,o,r)=>(e[o]=r,t.showUserUpdate(s,o),!0)});return s})},function(e,t,s){"use strict";const o=s(6),r=s(8);e.exports=((e,t,s)=>{const n=t=>{y.level=o(e,y,t)},a=s=>{const o=r(e,t.users.get(s.id),y);y.users.set(o.id,o),Object.assign(o,s.props),Object.assign(o.avatar,s.avatar.props)},i=(e,t)=>{new Set(["name"]).has(t)&&(y.els.userList.querySelector(`[data-id="${e.id}"] .${t}`).innerText=e[t])},c=e=>{y.users.get(e.id).avatar.sync(e)},l=e=>{Object.assign(y,e.props)},d=e=>{Object.assign(y.users.get(e.id),e.props)},u=()=>{e.socket.emit("leaveRoom"),e.socket.off("loadLocalLevel",n),e.socket.off("loadLocalUser",a),e.socket.off("syncAvatar",c),e.socket.off("syncLocalRoom",l),e.socket.off("syncLocalUser",d),e.socket.off("unloadLocalUser",p),y.els.leaveRoom.removeEventListener("click",u),y.els.startGame.removeEventListener("click",e.user.startGame),m(),v(),e.view="lobby"},m=()=>{y.level&&y.level.unload()},p=e=>{y.users.delete(e)},v=()=>{y.users.clear()},y=(()=>{const t={els:void 0,users:new Map,get showUserUpdate(){return i},get unload(){return u}},s=new Proxy(t,{set:(t,o,r)=>(t[o]=r,"ownerId"===o&&(s.els.userList.querySelector(`[data-id="${r}"]`).classList.add("owner"),r===e.user.id?s.els.startGame.classList.remove("hidden"):s.els.startGame.classList.add("hidden")),!0)});return s.users.set=function(e,t){return(({id:e,name:t})=>{y.els.userList.insertAdjacentHTML("beforeend",`<li data-id="${e}">`+`<span class="name">${t}</span>`+"</li>")})(t),Map.prototype.set.apply(this,arguments)},s.users.clear=function(){for(;s.els.userList.firstChild;)s.els.userList.removeChild(s.els.userList.firstChild);return Map.prototype.clear.apply(this,arguments)},s.users.delete=function(e){return(e=>{y.els.userList.querySelector(`[data-id=${e}]`).remove()})(e),Map.prototype.delete.apply(this,arguments)},s})();return(t=>{y.els={leaveRoom:document.getElementById("room-view-leave"),startGame:document.getElementById("room-view-start"),userList:document.getElementById("room-view-users")},e.user.room=y,t.users.forEach(e=>a(e)),Object.assign(y,t.props),y.els.userList.querySelector(`[data-id="${e.user.id}"]`).classList.add("personal"),e.socket.on("loadLocalLevel",n),e.socket.on("loadLocalUser",a),e.socket.on("syncAvatar",c),e.socket.on("syncLocalRoom",l),e.socket.on("syncLocalUser",d),e.socket.on("unloadLocalUser",p),y.els.leaveRoom.addEventListener("click",u),y.els.startGame.addEventListener("click",e.user.startGame),e.view="room"})(s),y})},function(e,t,s){"use strict";const o=s(7);e.exports=((e,t,s)=>{const r=s=>{a(s),(()=>{const s=d.room.users.get(e.user.id).avatar;l.text=`${Math.round(s.x)},${Math.round(s.y)} @ ${s.speed}`,t.users.forEach(e=>{const t=e.avatar;d.sprites.get(e.id).position.set(t.x,t.y)})})()},n=()=>{t.users.forEach(e=>{const t=PIXI.loader.resources.avatar.texture,s=new PIXI.Sprite(t);d.sprites.set(e.id,s),c.stage.addChild(d.sprites.get(e.id))})},a=e=>{const s=e/60*1e3;t.users.forEach(e=>{e.avatar.tick(s)})},i=()=>{c.ticker.destroy(),document.removeEventListener("keydown",e.user.avatar.startAction),document.removeEventListener("keyup",e.user.avatar.endAction),e.view="room"};let c,l;const d=(()=>{const s=new Set(["paused"]),o={room:t,sprites:new Map,tiles:[],get unload(){return i}};return new Proxy(o,{set:(t,o,r)=>s.has(o)?(e.socket.emit("syncLevel",{prop:o,val:r}),!0):(t[o]=r,!0)})})();return(t=>{Object.assign(d,t.props),document.addEventListener("keydown",e.user.avatar.startAction),document.addEventListener("keyup",e.user.avatar.endAction),d.tiles=t.tiles.map(e=>e.map(e=>o(e))),(c=new PIXI.Application({width:600,height:600})).renderer.backgroundColor=5592507,(()=>{const e=new PIXI.TextStyle({fill:"yellow",fontSize:16});(l=new PIXI.Text("...",e)).position.set(5,5),c.stage.addChild(l)})(),PIXI.loader.add([{name:"avatar",url:"images/avatar.png"},{name:"tiles",url:"images/tiles.png"}]).load(()=>{n(),c.ticker.add(e=>r(e))}),e.els.game.appendChild(c.view),e.user.avatar.load(),e.view="game"})(s),d})},function(e,t,s){"use strict";e.exports=(e=>{return e})},function(e,t,s){"use strict";const o=s(9);e.exports=((e,t,s)=>{return(()=>{const r=Object.assign({},t),n=new Proxy(r,{set:(e,t,o)=>(e[t]=o,s.showUserUpdate(n,t),!0)});return r.avatar=o(e,n),n})()})},function(e,t,s){"use strict";e.exports=((e,t)=>{const s=e=>{Object.assign(r,e.props)},o=e=>{r.x+=Math.cos(r.rad)*r.speed*e,r.y+=Math.sin(r.rad)*r.speed*e},r=(()=>{const r={socket:e.socket,user:t,get sync(){return s},get tick(){return o}};return new Proxy(r,{set:(e,t,s)=>(e[t]=s,!0)})})();return r})},function(e,t,s){"use strict";const o=s(11);e.exports=((e,t)=>{const s=t=>{e.socket.emit("joinRoom",t)},r=e=>{a.id=e},n=()=>{e.socket.emit("startGame")},a=(()=>{const t=new Set(["email","name"]),a={get createRoom(){return createRoom},get joinRoom(){return s},get load(){return r},get login(){return login},get startGame(){return n}},i=new Proxy(a,{set:(s,o,r)=>t.has(o)?(e.socket.emit("syncUser",{prop:o,val:r}),!0):(s[o]=r,!0)});return a.avatar=o(e,i),i})();return a})},function(e,t,s){"use strict";e.exports=((e,t)=>{const s=e=>{const t=n.input.get(e.key);if(t&&n.actions.has(t))switch(n.actions.delete(t),t){case"moveUp":case"moveRight":case"moveDown":case"moveLeft":n.actions.has("moveUp")||n.actions.has("moveRight")||n.actions.has("moveDown")||n.actions.has("moveLeft")||(n.speed=0)}},o=()=>{n.local=t.room.users.get(t.id).avatar},r=t=>{const s=n.input.get(t.key);if(s&&!n.actions.has(s))switch(n.actions.add(s),s){case"dropBomb":e.socket.emit(s);break;case"moveUp":n.rad=3*Math.PI/2,n.speed=n.local.speedLimit;break;case"moveRight":n.rad=0,n.speed=n.local.speedLimit;break;case"moveDown":n.rad=1*Math.PI/2,n.speed=n.local.speedLimit;break;case"moveLeft":n.rad=Math.PI,n.speed=n.local.speedLimit;break;case"pauseGame":n.level.paused=!n.level.paused}},n=(()=>{const a=new Set(["rad","speed"]),i={actions:new Set,input:new Map([[" ","dropBomb"],["ArrowUp","moveUp"],["ArrowRight","moveRight"],["ArrowDown","moveDown"],["ArrowLeft","moveLeft"],["p","pauseGame"]]),user:t,get endAction(){return s},get load(){return o},get startAction(){return r},get level(){return n.user.room.level}};return new Proxy(i,{set:(t,s,o)=>a.has(s)?(e.socket.emit("syncAvatar",{prop:s,val:o}),n.local[s]=o,!0):(t[s]=o,!0)})})();return n})}]);